# SSSD configuration for {{ ad_integration.domain }}
# Generated by Ansible - silverblue_ad_integration role

[sssd]
services = nss, pam
domains = {{ ad_integration.domain }}
config_file_version = 2

[nss]
filter_users = root,named,avahi,haldaemon,dbus,radiusd,news,nscd
filter_groups = root
reconnection_retries = 3

[pam]
reconnection_retries = 3
offline_credentials_expiration = 7
offline_failed_login_attempts = 3
offline_failed_login_delay = 5

[domain/{{ ad_integration.domain }}]
id_provider = ad
auth_provider = ad
access_provider = ad
chpass_provider = ad

# Domain settings
ad_domain = {{ ad_integration.domain }}
krb5_realm = {{ ad_integration.realm }}

# Domain controllers
{% if ad_integration.domain_controllers is defined %}
ad_server = {{ ad_integration.domain_controllers | join(', ') }}
{% endif %}

# User/group settings
ldap_id_mapping = true
fallback_homedir = {{ ad_integration.sssd.fallback_homedir }}
default_shell = {{ ad_integration.sssd.default_shell }}

# Credential caching
cache_credentials = {{ ad_integration.sssd.cache_credentials | lower }}
enumerate = {{ ad_integration.sssd.enumerate_users | lower }}

# Kerberos settings
krb5_store_password_if_offline = true
krb5_renewable_lifetime = {{ ad_integration.kerberos.renew_lifetime }}
krb5_lifetime = {{ ad_integration.kerberos.ticket_lifetime }}

# Performance tuning
ldap_referrals = false
ldap_id_use_start_tls = true

# Access control (use simple access provider if needed)
# access_provider = simple
# simple_allow_groups = Receptionists, GG-Reception

# Debugging (disable in production)
debug_level = 2

# Workstation audit rules for {{ hostname }}
# Generated by Ansible - silverblue_logging role

# Log all authentication events
-w /var/log/auth.log -p wa -k auth_log
-w /var/log/secure -p wa -k secure_log

# Log user login/logout
-w /var/log/lastlog -p wa -k login_logout
-w /var/run/faillock/ -p wa -k login_failures

# Log sudo usage
-w /etc/sudoers -p wa -k sudoers_changes
-w /etc/sudoers.d/ -p wa -k sudoers_changes

# Log PAM configuration changes
-w /etc/pam.d/ -p wa -k pam_config
-w /etc/security/access.conf -p wa -k access_control

# Log SSSD configuration
-w /etc/sssd/sssd.conf -p wa -k sssd_config

{% if logging.auditd.log_file_access | default(false) %}
# Log file access (optional, high verbosity)
-a always,exit -F arch=b64 -S open,openat,creat -k file_access
{% endif %}

{% if logging.auditd.log_user_commands | default(false) %}
# Log user commands (optional, high verbosity)
-a always,exit -F arch=b64 -S execve -k user_commands
{% endif %}

# Make configuration immutable (must be last)
-e 2
